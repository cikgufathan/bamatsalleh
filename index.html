<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HALL OF FAME - Arabic Merit Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --primary: #6366f1; --dark: #0f172a; --card: #1e293b;
            --gold: #fbbf24; --silver: #94a3b8; --bronze: #cd7f32;
        }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--dark); 
            color: white; 
            margin: 0; 
            padding: 20px; 
            min-height: 100vh;
        }

        /* HEADER & MUSIC */
        header { text-align: center; margin-bottom: 30px; position: relative; }
        .music-btn {
            position: absolute; top: 0; right: 0;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 15px; border-radius: 50px;
            cursor: pointer; transition: 0.3s;
        }
        .music-btn:hover { background: var(--primary); }
        .music-anim { animation: pulse 1.5s infinite; color: var(--gold); }

        /* SEARCH & TABS */
        .controls { max-width: 600px; margin: 0 auto 30px auto; display: flex; flex-direction: column; gap: 15px; }
        .search-box {
            background: var(--card); border: 1px solid #334155;
            padding: 15px; border-radius: 12px; color: white;
            width: 100%; box-sizing: border-box; font-size: 1.1rem;
            text-align: center;
        }
        .tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; justify-content: center; }
        .tab-btn {
            background: var(--card); color: #94a3b8; border: 1px solid #334155;
            padding: 8px 20px; border-radius: 20px; cursor: pointer; white-space: nowrap;
        }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }

        /* HALL OF FAME (TOP 3) */
        .hof-container {
            display: flex; justify-content: center; align-items: flex-end; gap: 15px;
            margin-bottom: 40px; min-height: 200px;
        }
        .hof-card {
            background: var(--card); border-radius: 15px; padding: 15px;
            text-align: center; width: 30%; position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border: 2px solid transparent;
            transition: transform 0.3s;
        }
        .hof-card:hover { transform: translateY(-5px); }
        
        .rank-1 { order: 2; height: 220px; border-color: var(--gold); background: linear-gradient(to bottom, #1e293b, #422006); z-index: 2; }
        .rank-2 { order: 1; height: 180px; border-color: var(--silver); background: linear-gradient(to bottom, #1e293b, #1e293b); }
        .rank-3 { order: 3; height: 160px; border-color: var(--bronze); background: linear-gradient(to bottom, #1e293b, #1e293b); }

        .crown { font-size: 2rem; margin-bottom: 10px; display: block; }
        .p-score { font-size: 1.8rem; font-weight: 800; margin: 10px 0; }
        .p-name { font-size: 0.9rem; font-weight: 600; line-height: 1.4; color: #e2e8f0; }

        /* LIST */
        .list-container { max-width: 800px; margin: 0 auto; }
        .student-row {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--card); margin-bottom: 10px; padding: 15px;
            border-radius: 12px; border: 1px solid #334155;
            transition: 0.2s;
        }
        .student-row:hover { transform: scale(1.01); background: #283649; }
        .s-rank { width: 30px; font-weight: bold; color: #64748b; }
        .s-info { flex-grow: 1; padding: 0 15px; }
        .s-points { font-weight: bold; color: var(--primary); font-size: 1.2rem; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        /* Loading */
        #loading { text-align: center; padding: 20px; color: #64748b; }
    </style>
</head>
<body onclick="playMusic()">

    <header>
        <h1><i class="fas fa-trophy" style="color:var(--gold)"></i> HALL OF FAME</h1>
        <p style="color:#94a3b8">Arabic Merit Pro Leaderboard</p>
        
        <button class="music-btn" onclick="toggleMusic(event)">
            <i class="fas fa-music" id="musicIcon"></i> Muzik
        </button>
    </header>

    <audio id="bgm" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_0783141b72.mp3" type="audio/mp3">
    </audio>

    <div class="controls">
        <div class="tabs" id="classTabs"></div>
        <input type="text" id="search" class="search-box" placeholder="Cari Nama Pelajar..." onkeyup="render()">
    </div>

    <div id="loading"><i class="fas fa-circle-notch fa-spin"></i> Sedang memuatkan data...</div>

    <div id="podium" class="hof-container" style="display:none"></div>

    <div id="list" class="list-container"></div>

<script>
    // URL SCRIPT SAMA
    const API_URL = "https://script.google.com/macros/s/AKfycbwJgeiE56ZauzhO9MMWOPKVIsaXuD8QvK1b6-n4RswZLNZ3M82GvDOikHU_gtCuS4R3/exec";
    
    let db = [];
    let classes = [];
    let activeClass = "";
    let musicStarted = false;

    // AUTO LOAD
    window.onload = loadData;

    async function loadData() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            
            // Format Data: [Nama, Skor, Kelas]
            db = data.map(r => ({ name: String(r[0]), score: parseInt(r[1]) || 0, class: String(r[2]) }));
            
            // Extract Classes
            classes = [...new Set(db.map(d => d.class))];
            if(classes.length > 0) activeClass = classes[0];

            renderTabs();
            render();
            document.getElementById('loading').style.display = 'none';

        } catch (e) {
            document.getElementById('loading').innerHTML = "Gagal menyambung ke server.";
        }
    }

    function renderTabs() {
        const c = document.getElementById('classTabs');
        c.innerHTML = classes.map(cls => 
            `<button class="tab-btn ${cls===activeClass?'active':''}" onclick="setClass('${cls}')">${cls}</button>`
        ).join('');
    }

    function setClass(cls) {
        activeClass = cls;
        renderTabs();
        render();
        playMusic(); // Pastikan muzik jalan bila tukar kelas
    }

    function render() {
        const q = document.getElementById('search').value.toUpperCase();
        
        // Filter & Sort
        let list = db.filter(s => s.class === activeClass).sort((a,b) => b.score - a.score);
        
        // Asingkan Top 3 untuk Podium
        const top3 = list.slice(0, 3);
        const others = list.slice(3);

        // Render Podium (Hanya jika tiada search)
        const podiumEl = document.getElementById('podium');
        if(q === "" && top3.length > 0) {
            podiumEl.style.display = 'flex';
            podiumEl.innerHTML = top3.map((p, i) => `
                <div class="hof-card rank-${i+1}">
                    <i class="fas fa-crown crown" style="color:${i===0? 'var(--gold)' : i===1? 'var(--silver)' : 'var(--bronze'}"></i>
                    <div class="p-score" style="color:${p.score<0?'#ef4444':'white'}">${p.score}</div>
                    <div class="p-name">${p.name}</div>
                </div>
            `).join('');
        } else {
            podiumEl.style.display = 'none'; // Sembunyi podium jika search aktif
        }

        // Render List Bawah
        const listEl = document.getElementById('list');
        let displayList = q === "" ? others : list.filter(s => s.name.toUpperCase().includes(q));

        listEl.innerHTML = displayList.map((p, i) => {
            // Jika search mode, rank ikut list asal, jika tidak, sambung lepas top 3
            let rank = q === "" ? i + 4 : list.indexOf(p) + 1;
            return `
            <div class="student-row">
                <div class="s-rank">#${rank}</div>
                <div class="s-info">
                    <div style="font-weight:600">${p.name}</div>
                    <small style="color:#64748b">${getBadge(p.score)}</small>
                </div>
                <div class="s-points" style="color:${p.score<0?'#ef4444':'var(--primary)'}">${p.score}</div>
            </div>
            `;
        }).join('');
    }

    function getBadge(s) {
        if(s >= 100) return "ðŸ‘‘ Khalifah";
        if(s >= 60) return "â­ Elite";
        if(s >= 30) return "ðŸ›¡ï¸ Pro";
        return "ðŸ‘¤ Newbie";
    }

    // --- MUSIC CONTROLLER ---
    function playMusic() {
        const audio = document.getElementById('bgm');
        if(!musicStarted) {
            audio.volume = 0.5;
            audio.play().then(() => {
                musicStarted = true;
                document.getElementById('musicIcon').classList.add('music-anim');
            }).catch(e => console.log("Tap screen to play music"));
        }
    }

    function toggleMusic(e) {
        e.stopPropagation(); // Elak trigger body onclick
        const audio = document.getElementById('bgm');
        const icon = document.getElementById('musicIcon');
        
        if(audio.paused) {
            audio.play();
            musicStarted = true;
            icon.classList.add('music-anim');
        } else {
            audio.pause();
            musicStarted = false;
            icon.classList.remove('music-anim');
        }
    }
</script>

</body>
</html>
